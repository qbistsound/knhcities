Vue.component("cities-header",{template:'<nav class="bar clearfix"><a href="javascript:;" class="brand"><img class="logo" src="/public/logo.png" /><span class="title">K&H</span></a><div class="menu search-menu"><input placeholder="Search..." type="text" id="knh-cities-search-input" v-on:keyup.enter="search()" /></div><div class="load-container"><div class="loader" v-if="$parent.loading">LOADING</div></div></nav>',methods:{search:function(){var a=document.getElementById("knh-cities-search-input");0>=a.value.trim().length&&this.$parent.download();2<a.value.trim().length&&this.$parent.search(a.value.trim())}}});Vue.component("cities-thumbnails",{template:'<transition name="fade"><div class="container" v-if="!$parent.loading"><div class="modal modal-window"><input id="city-modal" type="checkbox" /><label for="city-modal" class="overlay"></label><article v-if="$parent.records[selected]"><header><h3>{{ $parent.records[selected].name }}</h3></header><section class="content"><div class="modal-image"><img :src="\'data:image/png;base64, \' + $parent.records[selected].image"></div></section><footer v-if="$parent.editable === true"><a type="button" href="javascript:;" class="modal-button button"><input type="file" class="file-upload" @change="send($event)" /><span>UPLOAD</span></a><a type="button" href="javascript:;" class="modal-button button" @click="input()">RENAME</a><input type="text" id="knh-cities-name-input" :value="$parent.records[selected].name" style="display: none;" @blur="update()" v-on:keyup.enter="update()" /></footer></article></div><div class="flex five"><div v-for="(record, index) in $parent.records"><div class="thumbnail stack"><img :src="\'data:image/png;base64, \' + record.image"></div><label class="button stack" @click="modal(index)" for="city-modal">{{ record.name }}</label></div></div></div></transition>',data:function(){return{selected:null}},methods:{modal:function(a){this.selected=a},unmodal:function(){this.selected=null},input:function(){var a=document.getElementById("knh-cities-name-input");a.style.display="block";a.focus()},update:function(){var a=document.getElementById("knh-cities-name-input"),b=this,e=a.value,d=this.$parent.records[this.selected].id;e===this.$parent.records[this.selected].name?a.style.display="none":this.$parent.rename(d,e,function(){a.style.display="none";b.unmodal()})},send:function(a){if(0<a.target.files.length){var b=this;this.$parent.upload(a.target.files[0],this.$parent.records[this.selected].id,function(){b.unmodal()})}}}});Vue.component("cities-footer",{template:'<div class="footer"><div class="pagination" v-if="$parent.loading || $parent.paginate === false"><div class="\'paginate\'">&nbsp;</div></div><div class="pagination" v-if="!$parent.loading && $parent.paginate === true"><div :class="\'paginate left-arrow\' + (($parent.page === 1) ? \' disabled\' : \'\')" @click="previous()"><span>\u25c1</span></div><a v-for="(pagec, index) in $parent.pages" v-if="pagec < ($parent.count / $parent.len)" :class="\'paginate number-box\' + ((pagec === $parent.page) ? \' active\' : \'\')" @click="goto(pagec)"><span>{{ pagec }}</span></a><div class="paginate number-box disabled"><span>...</span></div><div :class="\'paginate number-box\' + (($parent.page === ($parent.count / $parent.len)) ? \' active\' : \'\')" @click="goto(parseInt(($parent.count / $parent.len)))"><span>{{ ($parent.count / $parent.len) }}</span></div><div :class="\'paginate left-arrow\' + (($parent.page === ($parent.count / $parent.len)) ? \' disabled\' : \'\')" @click="next()"><span>\u25b7</span></div></div></div>',methods:{"goto":function(a){return this.draw(a)},previous:function(){return this.draw(parseInt(0>=this.$parent.page-1?1:this.$parent.page-1))},next:function(){return this.draw(parseInt(this.$parent.page+1>this.$parent.count/this.$parent.len?this.$parent.count/this.$parent.len:this.$parent.page+1))},draw:function(a){this.$parent.records={};this.$parent.page=a;this.$parent.bof=this.$parent.len*this.$parent.page;this.$parent.download()}}});Vue.component("cities",{template:'<div class="u-full-width"><cities-header /><cities-thumbnails /><cities-footer /></div>',data:function(){return{loading:!1,records:{},bof:1,len:20,count:1,page:1,psize:6,pages:[],paginate:!1,editable:!1,url:"/_cities",sruri:"/_search",rnuri:"/_rename",uluri:"/_upload"}},methods:{search:function(a,b){var e=this;this.loading=!0;var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&setTimeout(function(){e.read(JSON.parse(d.responseText),b)},500)};d.open("POST",this.sruri,!0);var c=new FormData;c.append("_bof",this.bof);c.append("_size",this.len);c.append("_query",a);d.send(c)},rename:function(a,b,e){var d=this;this.loading=!0;var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&setTimeout(function(){d.read(JSON.parse(c.responseText),e)},500)};c.open("POST",this.rnuri,!0);var f=new FormData;f.append("_bof",this.bof);f.append("_size",this.len);f.append("_name",b);f.append("_id",a);c.send(f)},upload:function(a,b,e){var d=this;this.loading=!0;var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&setTimeout(function(){d.read(JSON.parse(c.responseText),e)},500)};c.open("POST",this.uluri,!0);var f=new FormData;f.append("file",a);f.append("_bof",this.bof);f.append("_size",this.len);f.append("_id",b);c.send(f)},download:function(){var a=this;this.loading=!0;var b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&setTimeout(function(){a.read(JSON.parse(b.responseText))},500)};b.open("GET",this.url+"?_bof="+this.bof+"&_size="+this.len,!0);b.send()},read:function(a,b){this.loading=!1;this.records=a.elements;this.count=a.count;this.editable=a.editable;this.paginate=a.paginate;this.pages=[];for(var e=parseInt(this.page<this.psize?this.psize:this.page+this.psize/2),d=parseInt(this.page<this.psize?1:e-this.psize);d<=e;d++)this.pages.push(parseInt(d));null!=b&&b()}},created:function(){this.download()}});var vm=new Vue({el:"#component"});